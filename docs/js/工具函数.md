---
slug: utils
tags: [js, utils]
---

## 去重
```js
/**
 * 去重
 */
handleDeduplicate(sourceArray,keyName) {
  let deduplicationList = [];
  let obj = {};
  for (let item of sourceArray) {
    if (!obj[item[keyName]]) {
      deduplicationList.push(item);
      obj[item[keyName]] = 1;
    }
  }
  return deduplicationList;
},
```

## 循环删数组元素
<CodeRun>
{`
var arr = [1,2,2,3,4,5];
var i = arr.length;
// 从后往前遍历
while (i--) {
  if (arr[i] == 2) {
    arr.splice(i,1);
  }
}
console.log(arr);
`}
</CodeRun>

也可以使用`filter`实现:
<CodeRun>
{`
var stuArr = [
  {name:'Jesse',gender:'male'},
  {name:'Leo',gender:'male'},
  {name:'Sophia',gender:'female'},
  {name:'Kathy',gender:'female'},
  {name:'Gaviin',gender:'male'}
];
stuArr = stuArr.filter(function (item) {
  return item.gender !== 'male';
});
console.log( stuArr );
// 删除后数组当前值: [ {name:'Sophia',gender:'female'}, {name:'Kathy',gender:'female'} ]
`}
</CodeRun>

## 使用`weakmap`实现深拷贝
```js
/**
 * 使用weakmap手写深拷贝
 */
deepClone(obj, hash = new WeakMap()) {
  const isComplexDataType = obj => (typeof obj === 'object' || typeof obj === 'function') && (obj !== null);
  if (obj.constructor === Date) return new Date(obj);
  if (obj.constructor === RegExp) return new RegExp(obj);
  if (hash.has(obj)) return hash.get(obj);
  let allDesc = Object.getOwnPropertyDescriptor(obj);
  let cloneObj = Object.create(Object.getPrototypeOf(obj), allDesc);
  hash.set(obj, cloneObj);
  for (const key of Reflect.ownKeys(obj)) {
    cloneObj[key] = (isComplexDataType(obj[key]) && typeof obj[key] !== 'function') ? this.deepClone(obj[key], hash) : obj[key];
  }
  return cloneObj;
},
```

## 数组转树；树转数组
> 参考：[list和tree的相互转换](https://juejin.cn/post/6952442048708345863)

## 正则表达式
### 提取小括号中的内容
```jsx live
function demo(props) {
  // 提取小括号中的内容
  let sourceStr = 'aa(bb)cc';
  let regex = /\((.+)\)/g; // 匹配小括号
  let tempString = sourceStr.match(regex)[0];
  let result = tempString.substring(1,tempString.length-1);

  return (
    <p>结果为：{result}</p>
  )
}
```

### 手机号码中间 4 位用星号（*）替换显示
```jsx live
function demo(props) {
  // 手机号码中间 4 位用星号（*）替换显示
  let phone = '13701134148';
  let result = phone.replace(/^(\d{3})\d{4}(\d+)/, '$1****$2');

  return (
    <p>结果为：{result}</p>
  )
}
```

### 手机号有效性校验
```js
if (!(/^1[3456789]\d{9}$/.test(phone))) return Toast.show({ content: '手机号需是11位有效手机号' });
```

## 判断一个对象是不是一个空对象
[使用Reflect.ownKeys判断对象自身为空](https://mp.weixin.qq.com/s/0vSXkIgoGNIGN6mNOTQCiA)

<CodeRun>{`
const a = Symbol()
const obj1 = {
  [a]: 1
}
const obj2 = {b: 2}
const obj3 = {}
Object.defineProperty(obj3, 'a', {
  value: 1,
  enumerable: false
})
const obj4 = {}
// 测试
console.log(Reflect.ownKeys(obj1).length === 0)  // false
console.log(Reflect.ownKeys(obj2).length === 0)  // false
console.log(Reflect.ownKeys(obj3).length === 0)  // false
console.log(Reflect.ownKeys(obj4).length === 0)  // true
`}</CodeRun>

## 复制
```js
function handleCopy(copyValue: string) {
  if (!navigator.clipboard) {
    // 1.创建一个可选中元素
    let textArea = document.createElement("textarea");
    textArea.value = copyValue;
    // 2.使用定位，阻止页面滚动
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
      let successFlag = document.execCommand('copy');
      if (successFlag) {
        Toast.show({
          content: '复制成功',
        });
      } else {
        Toast.show({
          content: '复制失败',
        });
      }
    } catch (err) {
      Toast.show({
        content: '复制失败',
      });
    }
    // 3.移除元素
    document.body.removeChild(textArea);
    return;
  }
  navigator.clipboard.writeText(copyValue).then(function() {
    Toast.show({
      content: '复制成功',
    });
  }, function(_err) {
    Toast.show({
      content: '复制失败',
    });
  });
}
```